{% set sectionName = 'index' %}

{% extends 'PhoenixJobQueueBundle::layout.html.twig' %}

{% block content %}

{{ parent() }}

    <h2>Queues</h2>
    <table class="table table-striped table-bordered">
        <thead>
        <tr>
            <th class="span3">Name</th>
            <th class="span2">Jobs</th>
        </tr>
        </thead>
        {% for queue in resque.queues %}
            <tr>
                <td>{{ queue.name }}</td>
                <td><a href="{{ path('phoenix_admin_job_queue_show', { queue: queue.name }) }}">{{ queue.size }}</a></td>
            </tr>
        {% endfor %}
    </table>

    <h2>Workers</h2>
    <table class="table table-striped table-bordered">
        <thead>
        <tr>
            <th class="span3">
                Where
            </th>
            <th class="span3">
                Queues
            </th>
            <th class="span4">
                Processing
            </th>
            <th class="span1">
                Processed
            </th>
            <th class="span1">
                Failed
            </th>
        </tr>
        </thead>

        {% for worker in resque.workers %}
            <tr>
                <td>{{ worker.id }}</td>
                <td>
                    {% for queue in worker.queues %}
                        <span class="label label-info">{{ queue.name }}</span>
                    {% endfor %}
                </td>
                <td>
                    {% set job = worker.currentJob %}
                    {% if job %}
                        <div>
                            <strong>{{ job.name }}</strong>
                        </div>
                        <div class="row">
                            <span class="pull-right">{{ worker.currentJobStart|date }}</span>
                        </div>
                        <div>
                            <span>
                                <ul class="unstyled">
                                    {% for argname, argvalue in job.args %}
                                        <li>
                                            <span>{{ argname }}</span>
                                            <em class="pull-right">{{ argvalue }}</em>
                                        </li>
                                    {% endfor %}
                                </ul>
                            </span>
                        </div>
                    {% else %}
                        <em>idle</em>
                    {% endif %}
                </td>
                <td>{{ worker.processedCount }}</td>
                <td>{{ worker.failedCount }}</td>
            </tr>
        {% else %}
            <tr>
                <td colspan="5">
                    <em>empty...</em>
                </td>
            </tr>
        {% endfor %}
    </table>

{% endblock %}
